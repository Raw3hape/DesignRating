# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Vercel KV –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è email-–∞–¥—Ä–µ—Å–æ–≤

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

–°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ email-–∞–¥—Ä–µ—Å–æ–≤ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** –≤ –∫–æ–¥–µ:
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ email
- ‚úÖ API endpoint –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è email
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–Ω–∞–ª–∏–∑–æ–º –¥–∏–∑–∞–π–Ω–∞
- ‚úÖ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Vercel KV!**

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Vercel KV

### 1. –°–æ–∑–¥–∞–Ω–∏–µ KV –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Vercel

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Vercel Dashboard](https://vercel.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç **DesignRating**
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Storage**
4. –ù–∞–∂–º–∏—Ç–µ **Create Database**
5. –í—ã–±–µ—Ä–∏—Ç–µ **KV** (Redis-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
6. –î–∞–π—Ç–µ –∏–º—è –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä: `designrating-kv`
7. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ, –≥–¥–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –ø—Ä–æ–µ–∫—Ç)
8. –ù–∞–∂–º–∏—Ç–µ **Create**

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ KV –∫ –ø—Ä–æ–µ–∫—Ç—É

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ KV –Ω–∞–∂–º–∏—Ç–µ **Connect Project**
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç **DesignRating**
3. –í—ã–±–µ—Ä–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: **Production**, **Preview**, **Development**
4. –ù–∞–∂–º–∏—Ç–µ **Connect**

Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `KV_REST_API_URL`
- `KV_REST_API_TOKEN`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å —Ä–µ–∞–ª—å–Ω–æ–π KV –±–∞–∑–æ–π:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ Vercel Dashboard:
   - Storage ‚Üí –≤–∞—à–∞ KV –±–∞–∑–∞ ‚Üí **.env.local** tab
   
2. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π `.env.local`:
```env
KV_REST_API_URL=https://your-kv-instance.kv.vercel-storage.com
KV_REST_API_TOKEN=your-token-here
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã:

1. **–õ–æ–∫–∞–ª—å–Ω–æ:**
   ```bash
   npm run dev
   ```
   - –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "Analyze" –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ email
   - Email –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ KV

2. **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/admin`
   - –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –∏–∑ `ADMIN_API_KEY`
   - –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 5. –î–µ–ø–ª–æ–π –Ω–∞ Vercel

1. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
   ```bash
   git add .
   git commit -m "Setup email collection with Vercel KV"
   git push
   ```

2. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–π KV –±–∞–∑–æ–π

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ KV

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ KV –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è:

```
user:{email}           - –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  {
    email: string,
    createdAt: string,
    analysisCount: number,
    lastAnalysis: string | null
  }

analysis:{id}          - –î–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞
  {
    id: string,
    email: string,
    score: number,
    category: string,
    imageCount: number,
    createdAt: string
  }

stats:global           - –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  {
    totalUsers: number,
    totalAnalyses: number,
    createdAt: string,
    updatedAt: string
  }

stats:daily:{date}     - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  {
    date: string,
    analyses: number,
    uniqueUsers: string[],
    uniqueUsersCount: number
  }
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –†–∞–±–æ—Ç–∞ –±–µ–∑ KV

–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Vercel KV, —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞–º—è—Ç—å—é:
- Email-–∞–¥—Ä–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Vercel CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Vercel CLI
npm i -g vercel

# –ü—Ä–∏–≤—è–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
vercel link

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
vercel env pull .env.local

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ KV
vercel logs
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–í Vercel Dashboard ‚Üí Storage ‚Üí –≤–∞—à–∞ KV –±–∞–∑–∞:
- **Metrics** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **Data Browser** - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Logs** - –ª–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

## –õ–∏–º–∏—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞

Vercel KV –Ω–∞ Hobby –ø–ª–∞–Ω–µ:
- 256MB —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- 3,000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
- 30,000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–µ—Å—è—Ü

–î–ª—è DesignRating —ç—Ç–æ–≥–æ –±–æ–ª–µ–µ —á–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!

## Troubleshooting

### –û—à–∏–±–∫–∞ "KV connection failed"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ KV –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏–æ–Ω KV –±–∞–∑—ã

### –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `/api/auth/email`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ADMIN_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### Rate limiting —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ
- –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ª–∏–º–∏—Ç—ã –≤ `/middleware.ts`
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ Upstash Redis

## –ì–æ—Ç–æ–≤–æ! üéâ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Vercel KV –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ email-–∞–¥—Ä–µ—Å–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞:
- Email-–∞–¥—Ä–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–¥–µ–∂–Ω–æ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–£–¥–∞—á–∏ —Å –∑–∞–ø—É—Å–∫–æ–º! üöÄ